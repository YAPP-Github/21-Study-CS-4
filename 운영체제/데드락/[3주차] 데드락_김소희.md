# 개념

> 두 개 이상의 프로세스나 스레드가 `서로 자원을 얻지 못해서 다음 처리를 하지 못하는 상태`

무한히 다음 자원을 기다리게 되는 상태를 뜻한다
시스템적으로 한정된 자원을 여러 곳에서 사용하려고 할 때 발생한다
> 

![image](https://user-images.githubusercontent.com/74011724/208625993-d91f475b-67e9-4b32-943e-18beb89f0055.png)


교착상태는 관련된 `모든 프로세스가 무한히 대기` 상태이다

그러나 기아상태는 `관련된 일부 프로세스가 지속적으로 대기` 상태이다

# 발생 조건

교착상태는 다음의 네 가지 조건이 동시에 만족할 때에만 발생한다

## 1. 상호 배제 : Mutaul Exclusion

> 프로세스들이 자원에 대한 배타적인 통제권을 요구한다
필요로 하는 자원을 다른 프로세스가 점유하고 있으면 반드시 대기해야 한다
> 

## 2. 점유 대기 : Hold and wait

> **이미 자원을 할당받아 점유하고 있는 상태**에서 
다른 프로세스가 점유하고 있는 자원이 해제되기를 **기다리는 상황**이다
> 

## 3. 비선점 : No preemption

> 할당된 자원은 그 프로세스의 작업 종류 후 자발적으로만 해제 가능하다 (중도 탈취 불허)
타의에 의해서는 해제 되지 않는다
> 

## 4. 순환 대기 : Circular wait

> 프로세스의 자원 점유 및 점유된 자원 요구 관계가 환형을 이루며 대기하는 조건이다
> 

# 처리 방법

교착 상태를 처리하는 데는 주로 세 가지 전략이 있다

각각 구현 상 난이도나 비용 면에서 특성과 장단점을 지닌다


## 1. 예방

교착 상태의 네 가지 조건 중 하나라도 발생할 수 없도록 막는 방법이다

교착 상태는 반드시 네 가지의 필요조건을 수반하므로, 하나라도 발생할 수 없게 한다면 교착 상태를 막을 수 있다

### 상호배제 조건의 제거

공유할 수 있는 자원은 상호배제를 할 필요가 없다

- 읽기 전용 파일을 액세스 하는 경우 동시에 여러 프로세스가 공유 가능하다

**그러나 공유할 수 없는 자원은 반드시 상호 배제를 따라야 하므로**

사실상 상호배제 조건을 제거하기는 불가능하다

### 점유 대기 조건의 제거

**프로세스가 자원을 요청할 때 어떠한 자원도 할당받지 않은 상태여야 한다**

1. 프로세스가 수행을 시작하기 전에 필요한 `모든 자원을 한꺼번에 요구`하여 할당받는다
    1. 나중에 쓰일 자원이라도 미리 할당 받게 되어 **자원이 낭비되고 이용도가 크게 저하된다**
2. 자원을 추가 요청할 때는 `이전에 가지고 있는 자원을 모두 해제`한다
    1. 매우 빈번히 사용되는 자원의 경우 요청하는 순간에 언제나 다른 프로세스에 할당될 수 있다
    2. **따라서 기아 상태가 발생할 수 있다**

### 비선점 조건의 제거

1. 프로세스가 다른 자원을 요청했을 때 즉시 사용할 수 없는 상태라면, `점유하고 있던 자원을 해제한다`
그 후 해제한 자원을 포함해 모든 자원이 사용 가능해지면 프로세스를 재개한다
2. 자원을 요청하면 먼저 가용 여부를 조사하고, `대기 중인 프로세스에게 할당되어 있다면 그 자원을 선점`한다
대기 상태에서 자원이 강제 해제된 프로세스는 그 자원을 다시 할당 받은 후에 작업을 수행한다

### 환형 대기 조건의 제거

모든 자원 유형에 일련 번호를 지정한다

프로세스는 자원을 일련 번호 기준으로 오름차순으로 요청한다


## 2. 회피

프로세스의 자원 사용에 대한 정보를 활용하여 교착 상태가 발생하지 않도록 한다

사전 정보는 다음과 같다

1. 현재 할당된 자원
2. 가용 상태의 자원
3. 프로세스들의 최대 요구량

![image](https://user-images.githubusercontent.com/74011724/208626036-5c031535-b8db-4f01-a1fb-89094d48dd69.png)


**안전 상태 : 교착상태를 회피하면서 각 프로세스에게 최대 요구량까지 빠짐없이 자원을 할당하는 상태**

교착 상태는 불안전 상태에서 발생한다

- 시스템이 불안정 상태일 때 할당 과정에 따라서 교착 상태가 될 수도 있다

또한 프로세스가 자원을 요청할 때 그 자원이 가용상태라고 하더라도 

안전 상태에 머물기 위해서 프로세스는 대기 상태가 될 수 있다

- 자원의 이용률은 저하될 수 있다

### 은행원 알고리즘

시스템이 자원을 요청받으면 **안전상태가 보장되는 경우에만 할당**한다

- 자원을 할당 해준 후의 상태를 계산하여 안전상태인지 확인한다

만약 안전 상태가 보장되지 않는다면 **다른 프로세스들이 자원을 해제할 때까지 대기**한다

## 3. 탐지 및 복구

교착 상태가 되도록 허용한 다음 회복시킨다

시스템의 상태를 주기적으로 조사하면서, 교착상태가 발생했다면 복구할 수 있는 조치를 해야한다

탐지 알고리즘을 각 자원 요청마다 수행하는 것은 부담이 된다

따라서 즉시 실행될 수 없는 할당 요쳥, 정해진 시간간격, CPU 효율이 일정 수준 이하로 떨어졌을 때만 수행한다


**복구 방법**

1. 교착상태를 일으킨 프로세스를 종료
    1. 교착 상태의 프로세스를 모두 중지
    2. 교착 상태가 제거될 때까지 하나씩 프로세스를 중지
2. 할당된 자원 회수
    1. 교착 상태의 프로세스가 점유하고 있는 자원을 선점해 다른 프로세스에게 할당
    2. 우선 순위가 낮거나 수행 횟수가 적은 프로세스 위주로 자원을 선점
